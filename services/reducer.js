'use strict';
import {
    REQUEST_EXCHANGE_RATE,
    SAVE_RATES,
    CHANGE_CURRENCY,
    EXCHANGE_MONEY, WITHDRAW_FUNDS
} from './actions';

const initialState = {
    pockets: [
        {currency: 'USD', sum: 0.00},
        {currency: 'GBP', sum: 0.00},
        {currency: 'EUR', sum: 0.00},
    ],
    currentCurrency: 'USD',
    resultCurrency: 'USD',
    resultSum: '',
    currentRate: '',
    currencies: {
        USD: {symbol: '$', desc: 'USD - American Dollar', pocketIndex: 0},
        GBP: {symbol: '£', desc: 'GBP - British Pound', pocketIndex: 1},
        EUR: {symbol: '€', desc: 'EUR - EURO', pocketIndex: 2},
    },
    rates: {
        'USD': {
            "AED": 3.673014,
            "AFN": 75.404,
            "ALL": 110.01,
            "AMD": 487.252102,
            "ANG": 1.805095,
            "AOA": 314.4975,
            "ARS": 38.8007,
            "AUD": 1.402623,
            "AWG": 1.800504,
            "AZN": 1.7025,
            "BAM": 1.72636,
            "BBD": 2,
            "BDT": 84.032,
            "BGN": 1.729603,
            "BHD": 0.377,
            "BIF": 1798.84304,
            "BMD": 1,
            "BND": 1.350549,
            "BOB": 6.913756,
            "BRL": 3.735103,
            "BSD": 1,
            "BTC": 0.000257875067,
            "BTN": 71.251242,
            "BWP": 10.54401,
            "BYN": 2.154805,
            "BZD": 2.015898,
            "CAD": 1.323003,
            "CDF": 1645.682272,
            "CHF": 1.004234,
            "CLF": 0.024214,
            "CLP": 660.785675,
            "CNH": 6.774819,
            "CNY": 6.76665,
            "COP": 3139.304785,
            "CRC": 608.748015,
            "CUC": 1,
            "CUP": 25.75,
            "CVE": 97.8025,
            "CZK": 22.742285,
            "DJF": 178,
            "DKK": 6.596331,
            "DOP": 50.625,
            "DZD": 118.744816,
            "EGP": 17.54,
            "ERN": 14.998011,
            "ETB": 28.420046,
            "EUR": 0.884097,
            "FJD": 2.124543,
            "FKP": 0.773661,
            "GBP": 0.773661,
            "GEL": 2.635,
            "GGP": 0.773661,
            "GHS": 5.2604,
            "GIP": 0.773661,
            "GMD": 49.55,
            "GNF": 9124.457035,
            "GTQ": 7.755751,
            "GYD": 208.66518,
            "HKD": 7.84758,
            "HNL": 24.415343,
            "HRK": 6.556301,
            "HTG": 82.71703,
            "HUF": 281.118667,
            "IDR": 14131.081522,
            "ILS": 3.6192,
            "IMP": 0.773661,
            "INR": 71.38889,
            "IQD": 1193.314309,
            "IRR": 42105,
            "ISK": 120.180029,
            "JEP": 0.773661,
            "JMD": 133.499989,
            "JOD": 0.709506,
            "JPY": 110.567,
            "KES": 100.15,
            "KGS": 68.678343,
            "KHR": 3997.73144,
            "KMF": 436.251524,
            "KPW": 900,
            "KRW": 1126.2,
            "KWD": 0.303857,
            "KYD": 0.833395,
            "KZT": 376.522344,
            "LAK": 8586.642324,
            "LBP": 1509.05,
            "LKR": 179.61,
            "LRD": 161.000189,
            "LSL": 14.078018,
            "LYD": 1.393689,
            "MAD": 9.53928,
            "MDL": 17.118982,
            "MGA": 3567.924158,
            "MKD": 54.732961,
            "MMK": 1529.094202,
            "MNT": 2513.036956,
            "MOP": 8.08367,
            "MRO": 357,
            "MRU": 36.5,
            "MUR": 34.347,
            "MVR": 15.449981,
            "MWK": 728.520412,
            "MXN": 19.24868,
            "MYR": 4.079802,
            "MZN": 62.515,
            "NAD": 14.078018,
            "NGN": 361.79,
            "NIO": 32.874087,
            "NOK": 8.606422,
            "NPR": 114.000977,
            "NZD": 1.460629,
            "OMR": 0.384942,
            "PAB": 1,
            "PEN": 3.321992,
            "PGK": 3.369929,
            "PHP": 52.33547,
            "PKR": 138.75,
            "PLN": 3.828162,
            "PYG": 6051.575183,
            "QAR": 3.641259,
            "RON": 4.195602,
            "RSD": 104.33126,
            "RUB": 66.1857,
            "RWF": 897.86533,
            "SAR": 3.75025,
            "SBD": 8.162191,
            "SCR": 13.662692,
            "SDG": 47.624879,
            "SEK": 9.252092,
            "SGD": 1.356899,
            "SHP": 0.773661,
            "SLL": 8390,
            "SOS": 578.605775,
            "SRD": 7.458,
            "SSP": 130.2634,
            "STD": 21050.59961,
            "STN": 21.8,
            "SVC": 8.750966,
            "SYP": 515.016525,
            "SZL": 14.076357,
            "THB": 31.21,
            "TJS": 9.436047,
            "TMT": 3.499986,
            "TND": 2.985658,
            "TOP": 2.2571,
            "TRY": 5.30498,
            "TTD": 6.77585,
            "TWD": 30.834631,
            "TZS": 2332.1,
            "UAH": 27.173,
            "UGX": 3668.461587,
            "USD": 1,
            "UYU": 32.575782,
            "UZS": 8393.600568,
            "VEF": 248487.642241,
            "VES": 3292.12905,
            "VND": 23240.663482,
            "VUV": 111.107679,
            "WST": 2.60309,
            "XAF": 579.929819,
            "XAG": 0.06325921,
            "XAU": 0.00075386,
            "XCD": 2.70255,
            "XDR": 0.718055,
            "XOF": 579.929819,
            "XPD": 0.00068519,
            "XPF": 105.500872,
            "XPT": 0.00123944,
            "YER": 250.300682,
            "ZAR": 14.129911,
            "ZMW": 11.951546,
            "ZWL": 322.355011
        },
        'GBP': {
            "AED": 3.673014,
            "AFN": 75.404,
            "ALL": 110.01,
            "AMD": 487.252102,
            "ANG": 1.805095,
            "AOA": 314.4975,
            "ARS": 38.8007,
            "AUD": 1.402623,
            "AWG": 1.800504,
            "AZN": 1.7025,
            "BAM": 1.72636,
            "BBD": 2,
            "BDT": 84.032,
            "BGN": 1.729603,
            "BHD": 0.377,
            "BIF": 1798.84304,
            "BMD": 1,
            "BND": 1.350549,
            "BOB": 6.913756,
            "BRL": 3.735103,
            "BSD": 1,
            "BTC": 0.000257875067,
            "BTN": 71.251242,
            "BWP": 10.54401,
            "BYN": 2.154805,
            "BZD": 2.015898,
            "CAD": 1.323003,
            "CDF": 1645.682272,
            "CHF": 1.004234,
            "CLF": 0.024214,
            "CLP": 660.785675,
            "CNH": 6.774819,
            "CNY": 6.76665,
            "COP": 3139.304785,
            "CRC": 608.748015,
            "CUC": 1,
            "CUP": 25.75,
            "CVE": 97.8025,
            "CZK": 22.742285,
            "DJF": 178,
            "DKK": 6.596331,
            "DOP": 50.625,
            "DZD": 118.744816,
            "EGP": 17.54,
            "ERN": 14.998011,
            "ETB": 28.420046,
            "EUR": 0.884097,
            "FJD": 2.124543,
            "FKP": 0.773661,
            "GBP": 0.773661,
            "GEL": 2.635,
            "GGP": 0.773661,
            "GHS": 5.2604,
            "GIP": 0.773661,
            "GMD": 49.55,
            "GNF": 9124.457035,
            "GTQ": 7.755751,
            "GYD": 208.66518,
            "HKD": 7.84758,
            "HNL": 24.415343,
            "HRK": 6.556301,
            "HTG": 82.71703,
            "HUF": 281.118667,
            "IDR": 14131.081522,
            "ILS": 3.6192,
            "IMP": 0.773661,
            "INR": 71.38889,
            "IQD": 1193.314309,
            "IRR": 42105,
            "ISK": 120.180029,
            "JEP": 0.773661,
            "JMD": 133.499989,
            "JOD": 0.709506,
            "JPY": 110.567,
            "KES": 100.15,
            "KGS": 68.678343,
            "KHR": 3997.73144,
            "KMF": 436.251524,
            "KPW": 900,
            "KRW": 1126.2,
            "KWD": 0.303857,
            "KYD": 0.833395,
            "KZT": 376.522344,
            "LAK": 8586.642324,
            "LBP": 1509.05,
            "LKR": 179.61,
            "LRD": 161.000189,
            "LSL": 14.078018,
            "LYD": 1.393689,
            "MAD": 9.53928,
            "MDL": 17.118982,
            "MGA": 3567.924158,
            "MKD": 54.732961,
            "MMK": 1529.094202,
            "MNT": 2513.036956,
            "MOP": 8.08367,
            "MRO": 357,
            "MRU": 36.5,
            "MUR": 34.347,
            "MVR": 15.449981,
            "MWK": 728.520412,
            "MXN": 19.24868,
            "MYR": 4.079802,
            "MZN": 62.515,
            "NAD": 14.078018,
            "NGN": 361.79,
            "NIO": 32.874087,
            "NOK": 8.606422,
            "NPR": 114.000977,
            "NZD": 1.460629,
            "OMR": 0.384942,
            "PAB": 1,
            "PEN": 3.321992,
            "PGK": 3.369929,
            "PHP": 52.33547,
            "PKR": 138.75,
            "PLN": 3.828162,
            "PYG": 6051.575183,
            "QAR": 3.641259,
            "RON": 4.195602,
            "RSD": 104.33126,
            "RUB": 66.1857,
            "RWF": 897.86533,
            "SAR": 3.75025,
            "SBD": 8.162191,
            "SCR": 13.662692,
            "SDG": 47.624879,
            "SEK": 9.252092,
            "SGD": 1.356899,
            "SHP": 0.773661,
            "SLL": 8390,
            "SOS": 578.605775,
            "SRD": 7.458,
            "SSP": 130.2634,
            "STD": 21050.59961,
            "STN": 21.8,
            "SVC": 8.750966,
            "SYP": 515.016525,
            "SZL": 14.076357,
            "THB": 31.21,
            "TJS": 9.436047,
            "TMT": 3.499986,
            "TND": 2.985658,
            "TOP": 2.2571,
            "TRY": 5.30498,
            "TTD": 6.77585,
            "TWD": 30.834631,
            "TZS": 2332.1,
            "UAH": 27.173,
            "UGX": 3668.461587,
            "USD": 1,
            "UYU": 32.575782,
            "UZS": 8393.600568,
            "VEF": 248487.642241,
            "VES": 3292.12905,
            "VND": 23240.663482,
            "VUV": 111.107679,
            "WST": 2.60309,
            "XAF": 579.929819,
            "XAG": 0.06325921,
            "XAU": 0.00075386,
            "XCD": 2.70255,
            "XDR": 0.718055,
            "XOF": 579.929819,
            "XPD": 0.00068519,
            "XPF": 105.500872,
            "XPT": 0.00123944,
            "YER": 250.300682,
            "ZAR": 14.129911,
            "ZMW": 11.951546,
            "ZWL": 322.355011
        },
        'EUR': {
            "AED": 3.673014,
            "AFN": 75.404,
            "ALL": 110.01,
            "AMD": 487.252102,
            "ANG": 1.805095,
            "AOA": 314.4975,
            "ARS": 38.8007,
            "AUD": 1.402623,
            "AWG": 1.800504,
            "AZN": 1.7025,
            "BAM": 1.72636,
            "BBD": 2,
            "BDT": 84.032,
            "BGN": 1.729603,
            "BHD": 0.377,
            "BIF": 1798.84304,
            "BMD": 1,
            "BND": 1.350549,
            "BOB": 6.913756,
            "BRL": 3.735103,
            "BSD": 1,
            "BTC": 0.000257875067,
            "BTN": 71.251242,
            "BWP": 10.54401,
            "BYN": 2.154805,
            "BZD": 2.015898,
            "CAD": 1.323003,
            "CDF": 1645.682272,
            "CHF": 1.004234,
            "CLF": 0.024214,
            "CLP": 660.785675,
            "CNH": 6.774819,
            "CNY": 6.76665,
            "COP": 3139.304785,
            "CRC": 608.748015,
            "CUC": 1,
            "CUP": 25.75,
            "CVE": 97.8025,
            "CZK": 22.742285,
            "DJF": 178,
            "DKK": 6.596331,
            "DOP": 50.625,
            "DZD": 118.744816,
            "EGP": 17.54,
            "ERN": 14.998011,
            "ETB": 28.420046,
            "EUR": 0.884097,
            "FJD": 2.124543,
            "FKP": 0.773661,
            "GBP": 0.773661,
            "GEL": 2.635,
            "GGP": 0.773661,
            "GHS": 5.2604,
            "GIP": 0.773661,
            "GMD": 49.55,
            "GNF": 9124.457035,
            "GTQ": 7.755751,
            "GYD": 208.66518,
            "HKD": 7.84758,
            "HNL": 24.415343,
            "HRK": 6.556301,
            "HTG": 82.71703,
            "HUF": 281.118667,
            "IDR": 14131.081522,
            "ILS": 3.6192,
            "IMP": 0.773661,
            "INR": 71.38889,
            "IQD": 1193.314309,
            "IRR": 42105,
            "ISK": 120.180029,
            "JEP": 0.773661,
            "JMD": 133.499989,
            "JOD": 0.709506,
            "JPY": 110.567,
            "KES": 100.15,
            "KGS": 68.678343,
            "KHR": 3997.73144,
            "KMF": 436.251524,
            "KPW": 900,
            "KRW": 1126.2,
            "KWD": 0.303857,
            "KYD": 0.833395,
            "KZT": 376.522344,
            "LAK": 8586.642324,
            "LBP": 1509.05,
            "LKR": 179.61,
            "LRD": 161.000189,
            "LSL": 14.078018,
            "LYD": 1.393689,
            "MAD": 9.53928,
            "MDL": 17.118982,
            "MGA": 3567.924158,
            "MKD": 54.732961,
            "MMK": 1529.094202,
            "MNT": 2513.036956,
            "MOP": 8.08367,
            "MRO": 357,
            "MRU": 36.5,
            "MUR": 34.347,
            "MVR": 15.449981,
            "MWK": 728.520412,
            "MXN": 19.24868,
            "MYR": 4.079802,
            "MZN": 62.515,
            "NAD": 14.078018,
            "NGN": 361.79,
            "NIO": 32.874087,
            "NOK": 8.606422,
            "NPR": 114.000977,
            "NZD": 1.460629,
            "OMR": 0.384942,
            "PAB": 1,
            "PEN": 3.321992,
            "PGK": 3.369929,
            "PHP": 52.33547,
            "PKR": 138.75,
            "PLN": 3.828162,
            "PYG": 6051.575183,
            "QAR": 3.641259,
            "RON": 4.195602,
            "RSD": 104.33126,
            "RUB": 66.1857,
            "RWF": 897.86533,
            "SAR": 3.75025,
            "SBD": 8.162191,
            "SCR": 13.662692,
            "SDG": 47.624879,
            "SEK": 9.252092,
            "SGD": 1.356899,
            "SHP": 0.773661,
            "SLL": 8390,
            "SOS": 578.605775,
            "SRD": 7.458,
            "SSP": 130.2634,
            "STD": 21050.59961,
            "STN": 21.8,
            "SVC": 8.750966,
            "SYP": 515.016525,
            "SZL": 14.076357,
            "THB": 31.21,
            "TJS": 9.436047,
            "TMT": 3.499986,
            "TND": 2.985658,
            "TOP": 2.2571,
            "TRY": 5.30498,
            "TTD": 6.77585,
            "TWD": 30.834631,
            "TZS": 2332.1,
            "UAH": 27.173,
            "UGX": 3668.461587,
            "USD": 1,
            "UYU": 32.575782,
            "UZS": 8393.600568,
            "VEF": 248487.642241,
            "VES": 3292.12905,
            "VND": 23240.663482,
            "VUV": 111.107679,
            "WST": 2.60309,
            "XAF": 579.929819,
            "XAG": 0.06325921,
            "XAU": 0.00075386,
            "XCD": 2.70255,
            "XDR": 0.718055,
            "XOF": 579.929819,
            "XPD": 0.00068519,
            "XPF": 105.500872,
            "XPT": 0.00123944,
            "YER": 250.300682,
            "ZAR": 14.129911,
            "ZMW": 11.951546,
            "ZWL": 322.355011
        }
    }
};

export default (state = initialState, action) => {
    switch (action.type) {
        case `${REQUEST_EXCHANGE_RATE}_FULLFILLED`:
            return state;
        case SAVE_RATES:
            console.log(action.payload.currency);
            console.log(action.payload.data.value.data.rates);
            return {...state, rates: {...state.rates, [action.payload.currency]: action.payload.data.value.data.rates}};
        case CHANGE_CURRENCY:
            let name = action.payload.resultCurrency ? 'resultCurrency' : 'currentCurrency';
            console.log(name);
            console.log(action.payload);
            let currencyRate = action.payload.resultCurrency
                ? state.rates[state.currentCurrency][state.pockets[action.payload.index].currency]
                : state.rates[state.pockets[action.payload.index].currency][state.resultCurrency];
            let reverseRate = action.payload.resultCurrency
                ? state.rates[state.pockets[action.payload.index].currency][state.currentCurrency]
                : state.rates[state.resultCurrency][state.pockets[action.payload.index].currency];
            console.log(currencyRate);
            console.log(reverseRate);
            return {...state, [name]: state.pockets[action.payload.index].currency, currentRate: currencyRate, reverseRate: reverseRate};

            case EXCHANGE_MONEY:
            let sum = action.payload.value;
            let resultSum = Math.round((action.payload.resultCurrency ? sum * state.reverseRate : sum * state.currentRate) * 100) / 100;
            if (action.payload.resultCurrency) {
                return {...state, resultSum: sum, initialSum: resultSum};
            } else {
                return {...state, resultSum: resultSum, initialSum: sum};
            }
        case WITHDRAW_FUNDS:
            let initialPocketIndex = state.currencies[state.currentCurrency].pocketIndex;
            let resultPocketIndex  = state.currencies[state.resultCurrency].pocketIndex;
            let initialPocket = state.pockets[initialPocketIndex];
            let resultPocket  = state.pockets[resultPocketIndex];
            initialPocket.sum = +initialPocket.sum - +state.initialSum;
            resultPocket.sum = +resultPocket.sum + +state.resultSum;
            let newPockets = state.pockets.slice();
            newPockets.splice(initialPocketIndex, 1, initialPocket);
            newPockets.splice(resultPocketIndex, 1, resultPocket);

            return {...state, pockets: newPockets};
        default:
            return state;
    }
};
